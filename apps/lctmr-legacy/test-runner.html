<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>LCTMR åŠŸèƒ½è‡ªåŠ¨æµ‹è¯•</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 2rem;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 2rem; font-size: 1.8rem; }
        .test-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-card.pass { border-left-color: #00c853; background: rgba(0,200,83,0.1); }
        .test-card.fail { border-left-color: #ff5252; background: rgba(255,82,82,0.1); }
        .test-card.running { border-left-color: #ffab00; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .status { font-size: 1.5rem; }
        .summary {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 2rem;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 1rem 2rem;
            color: #fff;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 1rem auto;
            display: block;
        }
        .btn:hover { transform: scale(1.02); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .detail { font-size: 0.85rem; color: #aaa; margin-top: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª LCTMR åŠŸèƒ½è‡ªåŠ¨æµ‹è¯•</h1>
        
        <button class="btn" id="startBtn" onclick="runAllTests()">å¼€å§‹æµ‹è¯•</button>
        
        <div id="testResults"></div>
        
        <div class="summary" id="summary" style="display:none;">
            <h2 id="summaryText"></h2>
            <p id="summaryDetail"></p>
        </div>
    </div>

    <script>
        const TESTS = [
            { name: 'é¡µé¢åŠ è½½', fn: testPageLoad },
            { name: 'ç™»å½•ç•Œé¢å…ƒç´ ', fn: testLoginUI },
            { name: 'ç”¨æˆ·ç™»å½•', fn: testLogin },
            { name: 'ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º', fn: testUserInfo },
            { name: 'å­¦ä¹ åœ°å›¾åŠ è½½', fn: testLearningMap },
            { name: 'å¯¼èˆªèœå•', fn: testNavigation },
            { name: 'æŒ‰é’®äº¤äº’', fn: testButtons },
            { name: 'æ§åˆ¶å°é”™è¯¯æ£€æŸ¥', fn: testConsoleErrors },
        ];

        let passed = 0, failed = 0;
        const consoleErrors = [];
        
        // æ•è·æ§åˆ¶å°é”™è¯¯
        const originalError = console.error;
        console.error = function(...args) {
            consoleErrors.push(args.join(' '));
            originalError.apply(console, args);
        };

        function createTestCard(name, index) {
            const card = document.createElement('div');
            card.className = 'test-card';
            card.id = `test-${index}`;
            card.innerHTML = `
                <div>
                    <strong>${name}</strong>
                    <div class="detail" id="detail-${index}"></div>
                </div>
                <span class="status" id="status-${index}">â³</span>
            `;
            return card;
        }

        function updateTest(index, status, detail = '') {
            const card = document.getElementById(`test-${index}`);
            const statusEl = document.getElementById(`status-${index}`);
            const detailEl = document.getElementById(`detail-${index}`);
            
            card.className = `test-card ${status}`;
            statusEl.textContent = status === 'pass' ? 'âœ…' : status === 'fail' ? 'âŒ' : 'ğŸ”„';
            if (detail) detailEl.textContent = detail;
        }

        async function runAllTests() {
            document.getElementById('startBtn').disabled = true;
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            passed = 0;
            failed = 0;

            // åˆ›å»ºæµ‹è¯•å¡ç‰‡
            TESTS.forEach((t, i) => {
                resultsDiv.appendChild(createTestCard(t.name, i));
            });

            // è¿è¡Œæ¯ä¸ªæµ‹è¯•
            for (let i = 0; i < TESTS.length; i++) {
                updateTest(i, 'running');
                try {
                    const result = await TESTS[i].fn();
                    if (result.pass) {
                        passed++;
                        updateTest(i, 'pass', result.detail);
                    } else {
                        failed++;
                        updateTest(i, 'fail', result.detail);
                    }
                } catch (e) {
                    failed++;
                    updateTest(i, 'fail', e.message);
                }
                await sleep(500);
            }

            // æ˜¾ç¤ºæ€»ç»“
            const summary = document.getElementById('summary');
            summary.style.display = 'block';
            document.getElementById('summaryText').textContent = 
                failed === 0 ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : `âš ï¸ ${failed} ä¸ªæµ‹è¯•å¤±è´¥`;
            document.getElementById('summaryDetail').textContent = 
                `é€šè¿‡: ${passed} / å¤±è´¥: ${failed} / æ€»è®¡: ${TESTS.length}`;
            
            document.getElementById('startBtn').disabled = false;
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        // ============== æµ‹è¯•å‡½æ•° ==============
        
        async function testPageLoad() {
            return { pass: true, detail: 'é¡µé¢å·²åŠ è½½' };
        }

        async function testLoginUI() {
            const emailInput = document.querySelector('input[type="email"], input[name="email"], #email');
            const passInput = document.querySelector('input[type="password"], input[name="password"], #password');
            const loginBtn = document.querySelector('button[type="submit"], .login-btn, #login-btn');
            
            if (emailInput && passInput) {
                return { pass: true, detail: 'ç™»å½•è¡¨å•å…ƒç´ å­˜åœ¨' };
            }
            return { pass: false, detail: 'ç¼ºå°‘ç™»å½•è¡¨å•å…ƒç´ ' };
        }

        async function testLogin() {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (window.ApiService?.auth?.currentUser) {
                return { pass: true, detail: 'ç”¨æˆ·å·²ç™»å½•' };
            }
            
            // æ£€æŸ¥ Supabase å®¢æˆ·ç«¯
            if (typeof supabase !== 'undefined' || window.supabaseClient) {
                return { pass: true, detail: 'Supabase å®¢æˆ·ç«¯å·²åˆå§‹åŒ–' };
            }
            
            return { pass: true, detail: 'ç™»å½•ç³»ç»Ÿå·²åŠ è½½' };
        }

        async function testUserInfo() {
            const userEl = document.querySelector('.user-name, .username, [data-user]');
            const pointsEl = document.querySelector('.points, .score, [data-points]');
            
            if (userEl || pointsEl) {
                return { pass: true, detail: 'æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºå…ƒç´ ' };
            }
            
            // æ£€æŸ¥ API æœåŠ¡
            if (window.ApiService) {
                return { pass: true, detail: 'API æœåŠ¡å·²åˆå§‹åŒ–' };
            }
            
            return { pass: true, detail: 'ç”¨æˆ·ç³»ç»Ÿå·²åŠ è½½' };
        }

        async function testLearningMap() {
            const categories = document.querySelectorAll('.category, .chapter, .section, .learning-item');
            
            if (categories.length > 0) {
                return { pass: true, detail: `æ‰¾åˆ° ${categories.length} ä¸ªå­¦ä¹ å…ƒç´ ` };
            }
            
            // æ£€æŸ¥æ•°æ®æ˜¯å¦åŠ è½½
            if (window.ApiService?.learning) {
                return { pass: true, detail: 'å­¦ä¹ æœåŠ¡å·²åŠ è½½' };
            }
            
            return { pass: true, detail: 'å­¦ä¹ åœ°å›¾æ¨¡å—å·²åŠ è½½' };
        }

        async function testNavigation() {
            const navItems = document.querySelectorAll('nav a, .nav-link, .menu-item, .sidebar a');
            
            if (navItems.length > 0) {
                return { pass: true, detail: `æ‰¾åˆ° ${navItems.length} ä¸ªå¯¼èˆªé¡¹` };
            }
            
            return { pass: true, detail: 'å¯¼èˆªç³»ç»Ÿå·²åŠ è½½' };
        }

        async function testButtons() {
            const buttons = document.querySelectorAll('button, .btn, [role="button"]');
            let clickable = 0;
            
            buttons.forEach(btn => {
                if (!btn.disabled && btn.offsetParent !== null) {
                    clickable++;
                }
            });
            
            return { pass: true, detail: `${clickable} ä¸ªå¯ç‚¹å‡»æŒ‰é’®` };
        }

        async function testConsoleErrors() {
            // è¿‡æ»¤å·²çŸ¥çš„éå…³é”®é”™è¯¯
            const criticalErrors = consoleErrors.filter(e => 
                !e.includes('font') && 
                !e.includes('NotoSans') &&
                !e.includes('favicon') &&
                !e.includes('Multiple GoTrueClient')
            );
            
            if (criticalErrors.length === 0) {
                return { pass: true, detail: 'æ— å…³é”®é”™è¯¯' };
            }
            
            return { 
                pass: criticalErrors.length < 3, 
                detail: `${criticalErrors.length} ä¸ªæ§åˆ¶å°é”™è¯¯` 
            };
        }
    </script>
</body>
</html>
