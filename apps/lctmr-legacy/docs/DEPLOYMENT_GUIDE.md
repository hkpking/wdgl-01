# éƒ¨ç½²æŒ‡å— - å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒç®¡ç†

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸ŠåŒæ—¶è¿è¡Œå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œå¹¶å®ç°å¿«é€Ÿè¿ç§»çš„æœ€ä½³å®è·µã€‚

## ğŸ—ï¸ ç¯å¢ƒæ¶æ„

### æ¨èçš„ç›®å½•ç»“æ„

```
/var/www/lctmr/
â”œâ”€â”€ backend/              # åç«¯ä»£ç ï¼ˆå…±äº«ï¼‰
â”œâ”€â”€ frontend/             # å‰ç«¯ä»£ç ï¼ˆå…±äº«ï¼‰
â”œâ”€â”€ env.development       # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ env.production        # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env                  # å½“å‰æ¿€æ´»çš„ç¯å¢ƒï¼ˆç”±è„šæœ¬è‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.sh         # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ setup-environments.sh
â”‚   â”œâ”€â”€ env-dev.sh        # å¿«é€Ÿåˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ
â”‚   â””â”€â”€ env-prod.sh       # å¿«é€Ÿåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ backend-development.log
â”‚   â””â”€â”€ backend-production.log
â””â”€â”€ backup/               # å¤‡ä»½ç›®å½•
    â””â”€â”€ env-backups/
```

## âœ… æœ€ä½³å®è·µ

### 1. ç¯å¢ƒéš”ç¦»

- âœ… **ä½¿ç”¨ç‹¬ç«‹çš„ç¯å¢ƒå˜é‡æ–‡ä»¶**ï¼š`env.development` å’Œ `env.production`
- âœ… **ä½¿ç”¨ä¸åŒçš„ç«¯å£**ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨ 3001ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ 3002
- âœ… **ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“**ï¼šå¼€å‘ç¯å¢ƒè¿æ¥ `lctmr_development`ï¼Œç”Ÿäº§ç¯å¢ƒè¿æ¥ `lctmr_production`
- âœ… **ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶**ï¼šæŒ‰ç¯å¢ƒåˆ†ç¦»æ—¥å¿—
- âœ… **å¹¶è¡Œè¿è¡Œ**ï¼šå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå¯ä»¥åŒæ—¶è¿è¡Œï¼Œäº’ä¸å½±å“

### 2. å¤šå®ä¾‹å¹¶è¡Œæ¶æ„ï¼ˆå·²å®ç°ï¼‰

**å½“å‰æ–¹æ¡ˆï¼šå¤šå®ä¾‹å¹¶è¡Œè¿è¡Œ**
- âœ… å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒåŒæ—¶è¿è¡Œåœ¨ä¸åŒç«¯å£
- âœ… æ¯ä¸ªç¯å¢ƒç‹¬ç«‹ç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯ï¼‰
- âœ… ä¿®æ”¹ä»£ç åï¼Œå¯å•ç‹¬é‡å¯å¯¹åº”ç¯å¢ƒ
- âœ… æ”¯æŒåœ¨å¼€å‘ç¯å¢ƒè°ƒè¯•æ—¶ï¼Œç”Ÿäº§ç¯å¢ƒç»§ç»­è¿è¡Œ

### 3. å®‰å…¨è€ƒè™‘

- âœ… ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸è¦æäº¤åˆ° Gitï¼ˆå·²åœ¨ `.gitignore` ä¸­ï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
- âœ… ç”Ÿäº§ç¯å¢ƒå¯ç”¨ SSL/TLS
- âœ… å®šæœŸå¤‡ä»½ç¯å¢ƒé…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç¯å¢ƒ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/lctmr

# è¿è¡Œç¯å¢ƒè®¾ç½®è„šæœ¬
./scripts/setup-environments.sh
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ `env.development` å’Œ `env.production` æ–‡ä»¶å·²æ­£ç¡®é…ç½®ï¼š

```bash
# å¼€å‘ç¯å¢ƒç¤ºä¾‹
NODE_ENV=development
DB_HOST=120.79.181.206
DB_NAME=lctmr_development
PORT=3001

# ç”Ÿäº§ç¯å¢ƒç¤ºä¾‹
NODE_ENV=production
DB_HOST=101.32.59.153
DB_NAME=lctmr_production
PORT=3001  # æˆ–ä½¿ç”¨ä¸åŒç«¯å£ï¼Œå¦‚ 3002
```

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å’Œç®¡ç†

#### å¯åŠ¨ç¯å¢ƒ

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆç«¯å£ 3001ï¼‰
./scripts/deploy.sh development start

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒï¼ˆç«¯å£ 3002ï¼‰
./scripts/deploy.sh production start
```

#### åœæ­¢ç¯å¢ƒ

```bash
# åœæ­¢å¼€å‘ç¯å¢ƒ
./scripts/deploy.sh development stop

# åœæ­¢ç”Ÿäº§ç¯å¢ƒ
./scripts/deploy.sh production stop
```

#### é‡å¯ç¯å¢ƒ

```bash
# é‡å¯å¼€å‘ç¯å¢ƒï¼ˆåº”ç”¨æœ€æ–°ä»£ç ï¼‰
./scripts/deploy.sh development restart

# é‡å¯ç”Ÿäº§ç¯å¢ƒï¼ˆåº”ç”¨æœ€æ–°ä»£ç ï¼‰
./scripts/deploy.sh production restart
```

#### éƒ¨ç½²ï¼ˆæ™ºèƒ½å¯åŠ¨/é‡å¯ï¼‰

```bash
# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒï¼ˆå¦‚æœè¿è¡Œåˆ™é‡å¯ï¼Œå¦åˆ™å¯åŠ¨ï¼‰
./scripts/deploy.sh development deploy

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚æœè¿è¡Œåˆ™é‡å¯ï¼Œå¦åˆ™å¯åŠ¨ï¼‰
./scripts/deploy.sh production deploy
```

#### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒçŠ¶æ€
./scripts/deploy.sh status
```

## ğŸ“ è„šæœ¬ä½¿ç”¨è¯´æ˜

### deploy.sh - å¤šå®ä¾‹å¹¶è¡Œç®¡ç†

ä¸»éƒ¨ç½²è„šæœ¬ï¼Œæ”¯æŒç‹¬ç«‹ç®¡ç†æ¯ä¸ªç¯å¢ƒï¼š

```bash
# å¯åŠ¨æŒ‡å®šç¯å¢ƒï¼ˆä¸å½±å“å¦ä¸€ä¸ªï¼‰
./scripts/deploy.sh [environment] start

# åœæ­¢æŒ‡å®šç¯å¢ƒ
./scripts/deploy.sh [environment] stop

# é‡å¯æŒ‡å®šç¯å¢ƒï¼ˆåº”ç”¨æœ€æ–°ä»£ç ï¼‰
./scripts/deploy.sh [environment] restart

# æ™ºèƒ½éƒ¨ç½²ï¼ˆè¿è¡Œåˆ™é‡å¯ï¼Œå¦åˆ™å¯åŠ¨ï¼‰
./scripts/deploy.sh [environment] deploy

# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒçŠ¶æ€
./scripts/deploy.sh status
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
./scripts/deploy.sh production start

# å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆä¸ç”Ÿäº§ç¯å¢ƒå¹¶è¡Œè¿è¡Œï¼‰
./scripts/deploy.sh development start

# åœ¨å¼€å‘ç¯å¢ƒä¿®æ”¹ä»£ç åï¼Œé‡å¯å¼€å‘ç¯å¢ƒæµ‹è¯•
./scripts/deploy.sh development restart

# å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œé‡å¯ç”Ÿäº§ç¯å¢ƒåº”ç”¨æ–°ä»£ç 
./scripts/deploy.sh production restart

# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒè¿è¡ŒçŠ¶æ€
./scripts/deploy.sh status
```

### å…¸å‹å·¥ä½œæµç¨‹

#### åœºæ™¯ï¼šå¼€å‘æ–°åŠŸèƒ½å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§

```bash
# 1. ç¡®ä¿ç”Ÿäº§ç¯å¢ƒåœ¨è¿è¡Œ
./scripts/deploy.sh production start

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒè¿›è¡Œå¼€å‘
./scripts/deploy.sh development start

# 3. ä¿®æ”¹ä»£ç ...

# 4. é‡å¯å¼€å‘ç¯å¢ƒæµ‹è¯•æ–°ä»£ç 
./scripts/deploy.sh development restart

# 5. åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œé‡å¯ç”Ÿäº§ç¯å¢ƒåº”ç”¨æ–°ä»£ç 
./scripts/deploy.sh production restart
```

### éƒ¨ç½²æµç¨‹è¯´æ˜

å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œè„šæœ¬ä¼šï¼š

1. âœ… æ£€æŸ¥ç¯å¢ƒé…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. âœ… è¯»å–ç¯å¢ƒé…ç½®ï¼ˆç«¯å£ã€æ•°æ®åº“ç­‰ï¼‰
3. âœ… æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
4. âœ… æ£€æŸ¥ Node.js å’Œä¾èµ–
5. âœ… å¯åŠ¨/åœæ­¢/é‡å¯æŒ‡å®šç¯å¢ƒçš„æœåŠ¡
6. âœ… æ‰§è¡Œå¥åº·æ£€æŸ¥
7. âœ… æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œæ—¥å¿—ä½ç½®

## ğŸ”„ å…¸å‹å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ 1ï¼šå¼€å‘æ–°åŠŸèƒ½

```bash
# 1. ç¡®ä¿ç”Ÿäº§ç¯å¢ƒæ­£å¸¸è¿è¡Œ
./scripts/deploy.sh production start

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/deploy.sh development start

# 3. æŸ¥çœ‹ä¸¤ä¸ªç¯å¢ƒçŠ¶æ€
./scripts/deploy.sh status

# 4. åœ¨å¼€å‘ç¯å¢ƒä¿®æ”¹ä»£ç ...

# 5. é‡å¯å¼€å‘ç¯å¢ƒåº”ç”¨æ–°ä»£ç 
./scripts/deploy.sh development restart

# 6. æµ‹è¯•å¼€å‘ç¯å¢ƒåŠŸèƒ½...

# 7. å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œé‡å¯ç”Ÿäº§ç¯å¢ƒ
./scripts/deploy.sh production restart

# 8. éªŒè¯ç”Ÿäº§ç¯å¢ƒ
curl http://localhost:3002/health
```

### åœºæ™¯ 2ï¼šä» Git æ›´æ–°ä»£ç 

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. é‡å¯å¼€å‘ç¯å¢ƒæµ‹è¯•
./scripts/deploy.sh development restart

# 3. æµ‹è¯•é€šè¿‡åï¼Œé‡å¯ç”Ÿäº§ç¯å¢ƒ
./scripts/deploy.sh production restart
```

### åœºæ™¯ 3ï¼šä»…æ›´æ–°ç”Ÿäº§ç¯å¢ƒ

```bash
# å¦‚æœåªéœ€è¦æ›´æ–°ç”Ÿäº§ç¯å¢ƒï¼ˆä»£ç å·²åœ¨æœåŠ¡å™¨ä¸Šï¼‰
./scripts/deploy.sh production restart
```

## ğŸ› ï¸ ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡ï¼Œå¯ä»¥ï¼š

```bash
# 1. å¤åˆ¶æœåŠ¡æ–‡ä»¶
sudo cp config/environments/lctmr-production.service /etc/systemd/system/
sudo cp config/environments/lctmr-development.service /etc/systemd/system/

# 2. é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# 3. å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable lctmr-production
sudo systemctl start lctmr-production

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status lctmr-production
```

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

1. æ£€æŸ¥æ—¥å¿—ï¼š`tail -f logs/backend-production.log`
2. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`cat .env`
3. æ£€æŸ¥ç«¯å£å ç”¨ï¼š`netstat -tlnp | grep 3001`
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼šç¡®è®¤ `DB_HOST` å’Œ `DB_PASSWORD` æ­£ç¡®

### ç¯å¢ƒåˆ‡æ¢ä¸ç”Ÿæ•ˆ

1. ç¡®è®¤ `.env` æ–‡ä»¶å·²æ›´æ–°ï¼š`cat .env | grep NODE_ENV`
2. ç¡®è®¤æœåŠ¡å·²é‡å¯ï¼š`ps aux | grep node`
3. æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶æ ¼å¼ï¼šç¡®ä¿æ²¡æœ‰è¯­æ³•é”™è¯¯

## ğŸ“Š ç›‘æ§å»ºè®®

- å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶
- ç›‘æ§æœåŠ¡è¿›ç¨‹çŠ¶æ€
- è®¾ç½®æ—¥å¿—è½®è½¬ï¼ˆlogrotateï¼‰
- ç›‘æ§æ•°æ®åº“è¿æ¥çŠ¶æ€

## ğŸ” å®‰å…¨å»ºè®®

1. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
   - æ°¸è¿œä¸è¦å°†ç¯å¢ƒå˜é‡æ–‡ä»¶æäº¤åˆ° Git
   - ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
   - å®šæœŸè½®æ¢å¯†é’¥

2. **è®¿é—®æ§åˆ¶**
   - é™åˆ¶ç”Ÿäº§ç¯å¢ƒçš„ç®¡ç†è®¿é—®
   - ä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶ç«¯å£è®¿é—®
   - å¯ç”¨ HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

3. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½ç¯å¢ƒé…ç½®æ–‡ä»¶
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - ä¿ç•™å¤šä¸ªå†å²ç‰ˆæœ¬

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¯å¢ƒé…ç½®è¯´æ˜](./ENVIRONMENT_CONFIG.md)
- [å®‰å…¨å®¡è®¡æŠ¥å‘Š](../SECURITY_AUDIT_REPORT.md)

---

**æœ€åæ›´æ–°**: 2025-01-27

